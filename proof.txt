#!/bin/sh

dir="$(pwd)"
commandslist="sudo apt update,sudo apt upgrade -y,sudo apt autoremove"
mirrors="git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git,git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"
i=1

networkcheck()
{
	ping google.com -c1 >> log.txt;
	errorcode=$(echo $?)
}

update()
{

	echo "$commandslist" | tr ',' '\n' | while read i;
		 do
			$(echo $i);
		done

	echo "$mirrors" | tr ',' '\n' | while read i;
		do
 			test ["$(ls -A $dir)"] && $(git pull $i &) || $(git clone $i && git pull $i &)
		done


<<<<<<< HEAD
if test $errorcode -eq 0
then
	ubuntupdate #updates ubuntu
	mirrorsupdate #updates mirrors
fi


=======
}


while [ $i -le 5 ]
do
	networkcheck
	if test $errorcode -eq 0
		then
			update
			break;
	else
		echo "No internet connection, try again!"
	fi
		sleep 20
done


corin@otp-cdobrica-l1:~/Desktop/Task2$ ./myupdater.sh 
Hit:1 http://mirrors.nav.ro/ubuntu jammy InRelease
Hit:2 http://mirrors.nav.ro/ubuntu jammy-updates InRelease
Hit:3 http://mirrors.nav.ro/ubuntu jammy-backports InRelease
Hit:4 http://mirrors.nav.ro/ubuntu jammy-security InRelease
Hit:5 http://packages.microsoft.com/repos/code stable InRelease
Reading package lists... Done                           
Building dependency tree... Done
Reading state information... Done
All packages are up to date.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Calculating upgrade... Done
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
From git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux
 * branch                      HEAD       -> FETCH_HEAD
fatal: refusing to merge unrelated histories
From git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux
 * branch                      HEAD       -> FETCH_HEAD
fatal: refusing to merge unrelated histories


crontab schedule:
00 01 * * * /home/corin/Desktop/Task2/myupdater.sh

